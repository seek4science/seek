<%= modal(size: 'lg', id: 'git-preview-modal', class: 'git-browser-modal') do %>
  <%= modal_header('Preview') %>
  <%= modal_body %>
<% end %>

<% if git_version.mutable? && git_version.can_edit? %>
  <%= modal(size: 'md', id: 'git-add-modal', class: 'git-browser-modal') do %>
    <%= modal_header('Add File') %>

    <%= modal_body do %>
      <%= render partial: 'git/add_file_form', locals: { resource: resource, version: git_version.version } %>
    <% end -%>
  <% end %>
  <%= button_link_to('Add file', 'add', '#', { class: 'pull-right', 'data-toggle' => 'modal', 'data-target' => '#git-add-modal' }) %>
<% end %>

<strong>Total size: </strong> <%= number_to_human_size git_version.total_size -%><br/>
<%= render partial: 'git/jstree', locals: { tree: git_version.tree, opts: { id: 'git-browser-jstree' } } %>

<script>
    $j(document).ready(function () {
        $j("#git-browser-jstree").on('dblclick','.jstree-anchor', function (e) {
            var jstree = $j.jstree.reference(this);
            var node = jstree.get_node(this);
            if (node.type === 'blob') {
                var path = '<%= polymorphic_path([resource, :git_blob], version: git_version.version, path: '__replaceme__') %>'.replace('__replaceme__', node.id)
                $j.ajax(path, {
                    success: function (html) {
                        $j('#git-preview-modal .modal-body').html(html);
                        $j('#git-preview-modal').modal('show');
                    }
                });
            }
        });
    })
</script>