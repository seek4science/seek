<% sample_row = []
   specimen_row = []
   strain_row = []
   new_specimen ||= false
   specimen_title = nil
   if object.kind_of?(Sample)
    sample_row = sample_row_data(object)
    specimen_row = specimen_row_data(object.specimen)
    strain = object.specimen.strain
    specimen_title = object.specimen.try(:title)
   elsif object.kind_of?(Specimen)
     specimen_row = specimen_row_data(object)
     strain = object.strain
     specimen_title = object.title
   elsif object.kind_of?(Strain)
     strain_row = strain_row_data(object)
     strain = object
   end

   strain_id = strain.try(:id)
   id_column = Seek::Config.is_virtualliver ? 8 : 6
 %>

<script type="text/javascript">
  /* submit and close Popup window for creating/updating sample/specimen after clicking create/update link from biosamples page.
  */
  action = "<%= action%>"
  if (!window.opener) {
        alert("New item was " + action + " but biosamples window was closed.");
        window.close();
    }

    object_class = "<%= object.class.name.downcase%>"
    sample_row = new Array;
    specimen_row = new Array;
    strain_row = new Array;
    <%sample_row.each do |column_data|%>
          sample_row.push('<%=escape_javascript(column_data.to_s)%>');
    <%end%>
    <%specimen_row.each do |column_data|%>
        specimen_row.push('<%=escape_javascript(column_data.to_s)%>');
    <%end%>
    <%strain_row.each do |column_data|%>
        strain_row.push('<%=escape_javascript(column_data.to_s)%>');
    <%end%>

    if (action == 'create' && object_class == 'sample' && "<%=new_specimen%>" == "true" ){
        window.opener.loadNewSpecimenAfterCreation(specimen_row, '<%=strain_id%>','<%=strain.is_dummy%>');
    }else if (action == 'create' && object_class == 'sample' && "<%=new_specimen%>" == "false"){
        window.opener.loadNewSampleAfterCreation(sample_row, '<%=specimen_title%>' );
    }else if (action == 'create' && object_class == 'specimen' ){
        window.opener.loadNewSpecimenAfterCreation(specimen_row,'<%=strain_id%>','<%=strain.is_dummy%>');
    }else if (action == 'update' && object_class == 'sample'){
        window.opener.updateSampleRow(sample_row, 6);
    }else if (action == 'update' && object_class == 'specimen'){
        window.opener.updateSpecimenRow( specimen_row,<%= id_column%>);
    }else if (action == 'create' && object_class == 'strain'){
        window.opener.loadNewStrainAfterCreation(strain_row,'<%=strain.organism.title%>');
    }else if (action == 'update' && object_class == 'strain') {
        window.opener.updateStrainRow(strain_row, 5);
    }

    alert("New item was " + action + "d!");
    window.close();
</script>
