<% nested, top_level = @extended_metadata_types.partition(&:extended_type?).each{ |group| group.sort_by!(&:id).reverse! } %>


<div class="alert alert-info">
  <ul>
    <li>
      You can disable Extended metadata types to prevent them from appearing as an option in the UI.
      Disabling them won't delete them, or where they've been used, and they can be re-enabled again here.
    </li>
    <li>
      If a type is disabled but has been used, for those cases it will no longer be shown when viewing those items.
      However, it will still be possible to edit the metadata for existing items and the metadata won't be deleted.
    </li>
    <li>
      The Extended metadata type cannot be deleted if there are existing Extended metadata instances based on it.
    </li>
    <li>
      The Extended metadata type in the nested level can not be deleted if it has been linked by other Extended metadata types.
    </li>
  </ul>
</div>

<% if ExtendedMetadataType.disabled_but_in_use.any? %>
  <div class="alert alert-warning">
    <p>
      Extended metadata types that are in use have been disabled, and are highlighted below.
    </p>
    <p>
      The existing metadata won't be lost but will be hidden and the metadata type unavailable for new items.
    </p>
  </div>
<% end %>

<ul class="nav nav-tabs" role="tablist">
  <li class="nav-item active in">
    <a class="nav-link" id="top-level-tab" data-toggle="tab" href="#top-level-metadata-table" role="tab" aria-controls="top-level" aria-selected="true" data-tooltip="Explain the top level">
      <span class="help_icon"></span>Top Level
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="nested-tab" data-toggle="tab" href="#nested-metadata-table" role="tab" aria-controls="nested" aria-selected="false" data-tooltip="Explain how to use nested type">
      <span class="help_icon"></span>Nested Level
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="sample-controlled-vocabs-tab" data-toggle="tab" href="#sample_controlled_vocabs" role="tab" aria-controls="sample_controlled_vocabs" aria-selected="false" data-tooltip="Explain how to use Controlled Vocabs">
      <span class="help_icon"></span>Controlled Vocabs
    </a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane fade active in" id="top-level-metadata-table" role="tabpanel" aria-labelledby="top-level-tab">
    <table class='table table-hover'>
      <thead>
      <tr>
        <th>Internal Id</th>
        <th>Title</th>
        <th>Supported Type</th>
        <th>Number of<br/> times used</th>
        <th>Status</th>
        <th></th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% top_level.each do |extended_metadata_type| %>
        <%= render partial: 'extended_metadata_type_table_row', locals: { extended_metadata_type: extended_metadata_type } %>
      <% end %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane fade" id="nested-metadata-table" role="tabpanel" aria-labelledby="nested-tab">
    <table class='table table-hover'>
      <thead>
      <tr>
        <th>Internal Id</th>
        <th>Title</th>
        <th>Supported Type</th>
        <th>Number of<br/> times used</th>
        <th>Status</th>
        <th></th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% nested.each do |extended_metadata_type| %>
        <%= render partial: 'extended_metadata_type_table_row', locals: { extended_metadata_type: extended_metadata_type } %>
      <% end %>
      </tbody>
    </table>
  </div>

  <div class="tab-pane fade" id="sample_controlled_vocabs" role="tabpanel" aria-labelledby="sample-controlled-vocabs-tab">
    <div class="row" style="padding: 10px 0px">
      <div class="col-md-3">
        <%= link_to new_sample_controlled_vocab_path, class: "btn btn-primary", role: "button", aria: { label: "Left Align" } do %>
          <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
          Create Controlled Vocabulary
        <% end %>
      </div>
    </div>
    <table class='table table-hover'>
      <thead>
      <tr>
        <th>Internal Id</th>
        <th>Title</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% SampleControlledVocab.all.each do |sample_controlled_vocab| %>
        <%= render partial: 'sample_controlled_vocab_table_row', locals: { sample_controlled_vocab: sample_controlled_vocab } %>
      <% end %>
      </tbody>
    </table>
  </div>
</div>