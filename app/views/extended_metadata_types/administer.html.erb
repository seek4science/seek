<style>
    td {
        vertical-align: middle !important;
    }
</style>

<div class="row">
  <div class="col-md-3">
    <%= link_to new_extended_metadata_type_path, class: "btn btn-primary", role: "button", aria: { label: "Left Align" } do %>
      <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
      Create Extended Metadata Type
    <% end %>
  </div>
</div>
<br>

<%= render partial: 'tabs' -%>

<script>
    var jobIdPresent = <%= session[:job_id].present? ? 'true' : 'false' %>;

    $j(document).ready(function() {
        ExtendedMetadataType.initializeNoticeFlash();

        if (sessionStorage.getItem('jobCompleted') === 'true') {
            sessionStorage.removeItem('jobCompleted');
            ExtendedMetadataType.updateJobStatusDisplay();
            ExtendedMetadataType.addNewMarker();
        }

        function checkJobStatus() {
            $j.ajax({
                url: "<%= populate_job_status_extended_metadata_types_path %>",
                dataType: "json",
                success: function(data) {
                    if (data.status === 'completed') {
                        console.log("Completed...");
                        sessionStorage.setItem('jobCompleted', 'true');
                        location.reload();
                        clearInterval(statusCheckInterval);
                    } else {
                        console.log("Processing...");
                    }
                }
            });
        }

        if (jobIdPresent) {
            var statusCheckInterval = setInterval(checkJobStatus, 5000);
            checkJobStatus();
        }
    });
</script>