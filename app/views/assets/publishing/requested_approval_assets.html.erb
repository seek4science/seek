<style type="text/css">
    span.published {
        font-size: 18px;
        font-weight: bold;
        color: green;
    }

    ul.item_for_decision {
        padding-left: 1em;
        margin-top: 2em;
        margin-bottom: 2em;
    }

    ul.item_for_decision li.type_and_title {
        font-weight: bolder;
    }

    span.approve {
        color: limegreen;
        font-weight: bolder;
    }

    span.reject {
        color: red;
        font-weight: bolder;
    }

    span.decide_later {
        font-weight: bolder;
    }

    img.icon_visibility {
        margin-left: 2em;
    }
</style>

<div class="show_basic">
  <br/>
  <div class="box_infotext">
    <ul style="padding-left:1em;">
      <li>
        <% project_names = current_user.person.projects_for_role('gatekeeper').collect(&:title) %>
        You are the <b>Gatekeeper</b> for the <%= project_names.count > 1 ? t('project').pluralize.downcase : t('project') %>
        : <%= project_names.join(', ') %>.
      </li>
      <li>
        As the <b>Gatekeeper</b>, you control the process of making the items within
        your <%= project_names.count > 1 ? t('project').pluralize : t('project') %> published, that is:
        the owners of the items ask for your approval to make the items published.
      </li>
      <li>
        The owners will be informed if you <span class="approve">approve</span> or <span class="reject">reject</span> the requests.
      </li>
    </ul>
  </div>

  <br/>
  <% if @requested_approval_assets.empty? %>
      <span class="published">You have no items waiting for your approval</span>
      <br/>
      <br/>
      <%= link_to "Back to profile", person_path(params[:id].to_i) -%>
  <% else %>
      <%= form_tag :action => :gatekeeper_decide do %>
          <h2>You have been requested to make the following items published. Please select your decision:</h2>
          <% isa_order = ['Investigation', 'Study', 'Assay']%>
          <% @requested_approval_assets.sort_by { |a| [a.is_isa? ? -1 : 1, isa_order.index(a.class.name), a.class.name] }.each do |asset| %>
              <ul class="item_for_decision">
                <li class="type_and_title">
                  <%= text_for_resource asset -%>:&nbsp;<%= link_to (asset.title), asset -%>
                  <%= list_item_visibility(asset, "icon_visibility") -%>
                </li>
                <li class="request_info">
                  Requested by:&nbsp;
                  <% asset.publish_requesters.each do |requester| %>
                      <%= link_to(requester.name, requester) %>
                      On
                      <%
                         log = ResourcePublishLog.where(["resource_type=? AND resource_id=? AND publish_state=? AND user_id=?",
                                                         asset.class.name, asset.id, ResourcePublishLog::WAITING_FOR_APPROVAL, requester.user.id]).last
                      %>
                      <%= date_as_string(log.created_at) %>
                      <br/>
                  <% end %>
                </li>

                <li class="radio_buttons">
                  <input type="radio" name="gatekeeper_decide[<%= asset.class.name %>][<%= asset.id %>][decision]" value="1"/>
                  <span class="approve" style="padding-right: 2em;">Approve</span>

                  <input type="radio" name="gatekeeper_decide[<%= asset.class.name %>][<%= asset.id %>][decision]" value="0"/>
                  <span class="reject" style="padding-right: 2em;">Reject</span>

                  <input type="radio" name="gatekeeper_decide[<%= asset.class.name %>][<%= asset.id %>][decision]" value="-1" checked="true"/>
                  <span class="decide_later">Decide later</span>
                </li>
                <li class="comment">
                  Reasons/comments(optional):
                  <br/>
                  <%= text_area_tag "gatekeeper_decide[#{asset.class.name}][#{asset.id}][comment]", nil, :style => "width: 50%;", :rows => 3 -%>
                </li>
              </ul>
          <% end %>

          <br/>
          <%= submit_tag "Submit", :disable_with => "Submitting ..." -%>
          Or
          <%= link_to "Cancel", person_path(params[:id].to_i) -%>
      <% end %>
  <% end %>
</div>

