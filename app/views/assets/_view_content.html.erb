<% icon_view ||= false %>
<% options = {} %>
<% url = nil %>
<% asset = content_blob.asset %>
<% asset_version = content_blob.asset_version %>


<% if Seek::Util.inline_viewable_content_types.include?(asset.class) %>

  <%# ---------- Case 1: Image or PDF / Inline viewable ---------- %>
  <% if content_blob.is_content_remotely_viewable? && !content_blob.is_supported_spreadsheet_format? %>
    <% if content_blob.is_image? %>
      <% zoom_width = content_blob.width.to_i.clamp(Seek::ActsAsFleximageExtension::STANDARD_SIZE,
                                                    Seek::ActsAsFleximageExtension::MAX_SIZE) %>

      <% url = polymorphic_path([asset, content_blob],
                                action: 'download',
                                disposition: 'inline',
                                code: params[:code],
                                image_size: zoom_width) %>

      <% options = { 'data-lightbox' => "view_content_blob_#{content_blob.id}", title: 'Preview' } %>

    <% else %> <%# PDF or other browser-viewable types %>
      <% url = polymorphic_path([asset, content_blob],
                                action: 'download',
                                disposition: 'inline',
                                code: params[:code]) %>
      <% options = { title: 'View content' } %>
    <% end %>

    <%# ---------- Case 2: Spreadsheet viewer ---------- %>
  <% elsif asset.supports_spreadsheet_explore? && content_blob.is_supported_spreadsheet_format? %>
    <% if content_blob.is_extractable_spreadsheet? %>
      <% url = polymorphic_path([asset],
                                action: 'explore',
                                code: params[:code],
                                version: asset_version) %>
      <% options = { title: 'Explore spreadsheet contents' } %>
    <% else %>
      <% options[:disabled_reason] = "Spreadsheet too large or unavailable for preview." %>
    <% end %>

    <%# ---------- Case 3: Downloadable but not inline ---------- %>
  <% elsif !asset.is_a?(Model) && asset.is_downloadable_asset? %>
    <% options[:disabled_reason] = "Format not viewable inline. " \
      "Supported formats: #{Seek::ContentTypeDetection.viewable_formats.join(', ')}" %>
  <% end %>

  <% if url || options[:disabled_reason] %>
    <%= icon_view ? icon_link_to('', 'show', url, options) : button_link_to('View content', 'show', url, options) %>
  <% end %>

<% end %>
