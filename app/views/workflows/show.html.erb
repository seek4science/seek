<%= render partial: 'general/item_title', locals: { item: @workflow,
                                                    version: @display_workflow.version,
                                                    buttons_partial: 'assets/asset_buttons' } -%>

<%= render partial: 'assets/upload_new_version_form', locals: { resource: @workflow } -%>

<div class="row">
  <div class="col-md-9 col-sm-8 box_about_actor">
    <% unless @display_workflow.main_workflow_blob %>
      <%= alert_box('warning', hide_button: true) do %>This workflow does not specify a "main" workflow file.<% end %>
    <% end %>

    <ul class="nav nav-tabs" role="tablist">
      <li class="active">
        <a href="#overview" aria-controls="overview" role="tab" data-toggle="tab">Overview</a>
      </li>
      <% if @display_workflow.is_git_versioned? %>
        <li>
          <a href="#files" aria-controls="files" role="tab" data-toggle="tab">Files</a>
        </li>
      <% end %>
    </ul>

    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="overview">
        <strong><%= WorkflowClass.model_name.human %>: </strong> <%= @display_workflow.workflow_class_title -%>

        <div style="margin-bottom: 5px;">
          <% if @display_workflow.maturity_level %>
            <%= maturity_badge(@display_workflow.maturity_level) %>
          <% end %>

          <% if @display_workflow.test_status %>
            <%= test_status_badge(@display_workflow.test_status) %>
          <% end %>
        </div>

        <%= item_description(@display_workflow.description) %>

        <% begin %>
          <% if @display_workflow.diagram_exists? || @display_workflow.can_render_diagram? %>
            <div class="row">
              <div class="col-md-12">
                <div class="workflow-diagram">
                  <%= image_tag(diagram_workflow_path(@workflow, version: @display_workflow.version)) %>
                </div>
              </div>
            </div>
          <% end %>
        <% rescue StandardError => e %>
          <% Rails.logger.error(e.inspect) %>
          <% Rails.logger.error(e.backtrace.join("\n")) %>
          <div class="alert alert-warning">Could not render the workflow diagram.</div>
        <% end %>

        <div class="row">
          <div class="col-md-6">
            <%= persistent_resource_id(@display_workflow) %>

            <%= render partial: 'assets/special_auth_code_display', locals: { resource: @workflow } %>
            <%= render partial: 'assets/asset_doi', locals: { displayed_resource: @display_workflow } %>
          </div>
        </div>

        <% unless @display_workflow.internals.empty? %>
          <div class="row">
            <div class="col-md-12">
              <%= render partial: 'workflows/workflow_internals', locals: { structure: @display_workflow.structure } %>
            </div>
          </div>
        <% end %>

        <%# rendered_asset_view(@display_workflow) %>

        <%= render partial: 'workflow_data_files' if Seek::Config.data_files_enabled %>

        <% if Seek::Config.isa_enabled %>
          <%= render partial: 'general/isa_graph', locals: { root_item: @workflow, deep: true, include_parents: true } %>
        <% end %>
      </div>

      <% if @display_workflow.is_git_versioned? %>
        <div role="tabpanel" class="tab-pane" id="files">
          <%= render partial: 'git/files', locals: { resource: @workflow, git_version: @display_workflow } %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="col-md-3 col-sm-4">
    <%= render partial: 'assets/resource_main_content_right', locals: { resource: @workflow, versioned_resource: @display_workflow } %>
  </div>
</div>

<%= render partial: 'assets/resource_version_details', locals: { displayed_resource: @display_workflow, resource: @workflow } -%>

<%# get, classify and authorize all assets for this project -%>
<%= render partial: 'general/items_related_to', object: @workflow %>
