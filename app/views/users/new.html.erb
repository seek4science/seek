
<%
  term_and_conditions_required = User.any? && Seek::Config.terms_enabled
%>

<% if User.count == 0 -%>
    <%= alert_box('info', :hide_button => true) do %>
        There are currently no users defined in the system. You should now register an initial user.
        This initial user will become the Administrator of the system.<br/>
        You will also be added to a default <%= t('project') %> and <%= t('institution') %> which you will be able to edit later.
    <% end %>
<% end -%>
<% strategy = params[:strategy] || 'password' %>

<% if Seek::Config.registration_disabled -%>
<div class="panel panel-default" id="home_description">
  <div class="panel-body">
    <%= registration_disabled_description_text -%>
  </div>
</div>
<% else  %>
  <p style="text-align:right">
    <%= help_link :registering,link_text:'Registration guide',include_icon:true %>
  </p>
  <div class="panel panel-default" id="login-panel">
    <div class="panel-heading">
      <h4 class="panel-title">Register an account for <%= Seek::Config.instance_name %></h4>
    </div>
    <div class="panel-body">
      <% if show_omniauth_login? %>
        <ul class="nav nav-tabs" role="tablist">
          <%= content_tag(:li, role: 'presentation', class: strategy == 'password' ? 'active' : nil) do %>
            <a href="#password_registration" aria-controls="password_registration" role="tab" data-toggle="tab">SEEK login</a>
          <% end %>
          <% if show_elixir_aai_login? %>
            <%= content_tag(:li, role: 'presentation', class: strategy == 'elixir_aai' ? 'active' : nil) do %>
              <a href="#elixir_aai_registration" aria-controls="elixir_aai_registration" role="tab" data-toggle="tab"><%= omniauth_method_name(:elixir_aai) %></a>
            <% end %>
          <% end %>
          <% if show_ldap_login? %>
            <%= content_tag(:li, role: 'presentation', class: strategy == 'ldap' ? 'active' : nil) do %>
              <a href="#ldap_registration" aria-controls="ldap_registration" role="tab" data-toggle="tab"><%= omniauth_method_name(:ldap) %></a>
            <% end %>
          <% end %>
          <% if show_github_login? %>
            <%= content_tag(:li, role: 'presentation', class: strategy == 'github' ? 'active' : nil) do %>
              <a href="#github_registration" aria-controls="github_registration" role="tab" data-toggle="tab"><%= omniauth_method_name(:github) %></a>
            <% end %>
          <% end %>
          <% if show_oidc_login? %>
            <%= content_tag(:li, role: 'presentation', class: strategy == 'oidc' ? 'active' : nil) do %>
              <a href="#oidc_registration" aria-controls="oidc_registration" role="tab" data-toggle="tab"><%= omniauth_method_name(:oidc) %></a>
            <% end %>
          <% end %>
        </ul>
      <% end #omniauth enabled and providers available %>

      <div class="tab-content">
        <%= content_tag(:div, id: 'password_registration', role: 'tabpanel', class: strategy == 'password' ? 'tab-pane active' : 'tab-pane') do %>
          <%= form_for @user do |f| -%>


            <div class="form-group">
              <label>Username</label>
              <%= f.text_field :login, :placeholder => 'Username', :class => 'form-control' %>
              <p class="help-block">The username should contain a minimum of 3 characters.</p>
            </div>

            <div class="form-group">
              <label>Email address</label>
              <%= f.text_field :email, placeholder:'Email address',:class => 'form-control' %>
            </div>

            <div class="form-group">
              <label>Password</label>
              <%= f.password_field :password, :placeholder => 'Password', :class => 'form-control' %>
              <p class="help-block">Password should contain a minimum of <%= User::MIN_PASSWORD_LENGTH %> characters.</p>
            </div>

            <div class="form-group">
              <label>Confirm Password</label>
              <%= f.password_field :password_confirmation,:placeholder=> 'Password', :class => 'form-control' %>
            </div>

            <%= submit_tag 'Register', data: { disable_with: 'Registering...' }, :class => 'btn btn-primary', disabled: term_and_conditions_required %>
          <% end -%>
        <% end %>

        <% if show_omniauth_login? %>
          <% if show_elixir_aai_login? %>
            <%= content_tag(:div, id: 'elixir_aai_registration', role: 'tabpanel', class: strategy == 'elixir_aai' ? 'tab-pane active' : 'tab-pane') do %>
              <div class='text-center'>
                <%= link_to image('ls_aai_login'), omniauth_authorize_path(:elixir_aai, state: "return_to:/"), name: 'commit', class: 'btn', method: :post, disabled: term_and_conditions_required %>
              </div>
            <% end %>
          <% end %>
          <% if show_ldap_login? %>
            <%= content_tag(:div, id: 'ldap_registration', role: 'tabpanel', class: strategy == 'ldap' ? 'tab-pane active' : 'tab-pane') do %>
              <%= render partial: 'identities/ldap_form', locals: { original_path: '/', button_text: 'Register', disabled: term_and_conditions_required } %>
            <% end %>
          <% end %>
          <% if show_github_login? %>
            <%= content_tag(:div, id: 'github_registration', role: 'tabpanel', class: strategy == 'github' ? 'tab-pane active' : 'tab-pane') do %>
              <div class='text-center'>
                <%= button_link_to 'Register with GitHub', 'github_large', omniauth_authorize_path(:github, state: "return_to:/"), name: 'commit', disabled: term_and_conditions_required, method: :post %>
              </div>
            <% end %>
          <% end %>
          <% if show_oidc_login? %>
            <%= content_tag(:div, id: 'oidc_registration', role: 'tabpanel', class: strategy == 'oidc' ? 'tab-pane active' : 'tab-pane') do %>
              <div class='text-center'>
                <%= oidc_register_button(term_and_conditions_required) %>
              </div>
            <% end %>
          <% end %>
        <% end #omniauth enabled and providers available %>

      </div>
      <% if term_and_conditions_required %>
        <div id="register-terms-and-conds" class="text-center">
          <label>
            <%= check_box_tag "tc_agree","1",false -%> I have read and agree to the
            <%= link_to 'Terms and Conditions and the Data Policy', terms_home_path ,'data-popup' => true,
                        :onclick=>"window.open(this.href,'terms', 'height=700, width=600, left=500, top=100'); return false;" %>
          </label>
        </div>
      <% end %>

    </div>
    <div class="panel-footer">
      <%= link_to "Already registered? - goto Login", login_path %>
    </div>
  </div>
<% end -%>



<script type="text/javascript">
    $j(document).ready(function () {
        $j('input:checkbox').change(
            function () {
                if ($j(this).is(':checked')) {
                    $j("[name=commit]").attr("disabled", false);
                } else {
                    $j("[name=commit]").attr("disabled", true);
                }
            });
    });

</script>
